# Langfuse í†µí•© ê°€ì´ë“œ - AWS Bedrock AgentCore

Amazon Bedrock AgentCore ë° Strands Agentsì™€ Langfuse ê´€ì¸¡ì„±(Observability)ì„ í†µí•©í•˜ëŠ” ì¢…í•© ê°€ì´ë“œì…ë‹ˆë‹¤.

## ëª©ì°¨

- [ê°œìš”](#ê°œìš”)
- [Langfuse í˜¸ìŠ¤íŒ… ì˜µì…˜](#langfuse-í˜¸ìŠ¤íŒ…-ì˜µì…˜)
- [ì•„í‚¤í…ì²˜: ë™ì‘ ì›ë¦¬](#ì•„í‚¤í…ì²˜-ë™ì‘-ì›ë¦¬)
- [OpenTelemetry: ì—°ê²° ë‹¤ë¦¬](#opentelemetry-ì—°ê²°-ë‹¤ë¦¬)
- [íŠ¸ë ˆì´ìŠ¤ ê³„ì¸µ êµ¬ì¡°ì™€ ìˆ˜ì§‘ ë°ì´í„°](#íŠ¸ë ˆì´ìŠ¤-ê³„ì¸µ-êµ¬ì¡°ì™€-ìˆ˜ì§‘-ë°ì´í„°)
- [ì¸ì¦ íë¦„](#ì¸ì¦-íë¦„)
- [ë°°í¬ ëª¨ë“œ](#ë°°í¬-ëª¨ë“œ)
- [í™˜ê²½ ì„¤ì •](#í™˜ê²½-ì„¤ì •)
- [ì—ì´ì „íŠ¸ ë£¨í”„ ìƒì„¸ ë¶„ì„](#ì—ì´ì „íŠ¸-ë£¨í”„-ìƒì„¸-ë¶„ì„)
- [ë‹¨ê³„ë³„ LLM ì…ì¶œë ¥](#ë‹¨ê³„ë³„-llm-ì…ì¶œë ¥)
- [CloudWatch vs Langfuse ë¹„êµ](#cloudwatch-vs-langfuse-ë¹„êµ)
- [êµ¬í˜„ ì˜ˆì œ](#êµ¬í˜„-ì˜ˆì œ)
- [ë¬¸ì œ í•´ê²°](#ë¬¸ì œ-í•´ê²°)
- [ì°¸ê³  ìë£Œ](#ì°¸ê³ -ìë£Œ)

---

## ê°œìš”

LangfuseëŠ” AI ì—ì´ì „íŠ¸ë¥¼ ìœ„í•œ **ì˜¤í”ˆì†ŒìŠ¤ LLM ê´€ì¸¡ì„± í”Œë«í¼**ì…ë‹ˆë‹¤. íŠ¸ë ˆì´ì‹±, ëª¨ë‹ˆí„°ë§, í‰ê°€ ê¸°ëŠ¥ì„ ì œê³µí•˜ë©°, Amazon Bedrock AgentCoreì™€ í†µí•©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

| ê¸°ëŠ¥ | ì„¤ëª… |
|------|------|
| **íŠ¸ë ˆì´ìŠ¤ ì‹œê°í™”** | ì—ì´ì „íŠ¸ ì‹¤í–‰ì˜ ê³„ì¸µì  ë·° ì œê³µ |
| **ë¹„ìš© ì¶”ì ** | ëª¨ë¸ë³„ í† í° ì‚¬ìš©ëŸ‰ ë° ê°€ê²© ìƒì„¸ ë¶„ì„ |
| **LLM Playground** | í”„ë¡¬í”„íŠ¸ ì¬ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸ |
| **í‰ê°€ (Evaluations)** | LLM-as-a-judge ìë™ í‰ê°€ |
| **í”„ë¡¬í”„íŠ¸ ê´€ë¦¬** | í”„ë¡¬í”„íŠ¸ ë²„ì „ ê´€ë¦¬ |
| **ì„¸ì…˜ ë¶„ì„** | ë©€í‹°í„´ ëŒ€í™” ê·¸ë£¹í™” ë° ë¶„ì„ |

### í†µí•© ë°©ì‹

Strands Agentsì™€ LangfuseëŠ” **OpenTelemetry (OTEL)** í”„ë¡œí† ì½œì„ í†µí•´ ì—°ë™ë©ë‹ˆë‹¤. Strands Agentsê°€ OTEL í˜•ì‹ì˜ íŠ¸ë ˆì´ìŠ¤ë¥¼ ìƒì„±í•˜ê³ , HTTPë¥¼ í†µí•´ Langfuseì˜ OTEL ì—”ë“œí¬ì¸íŠ¸ë¡œ ì „ì†¡í•©ë‹ˆë‹¤.

```
Strands Agent â†’ OTEL Exporter â†’ Langfuse OTEL Endpoint â†’ Langfuse ëŒ€ì‹œë³´ë“œ
```

---

## Langfuse í˜¸ìŠ¤íŒ… ì˜µì…˜

LangfuseëŠ” ë‘ ê°€ì§€ ë°©ì‹ìœ¼ë¡œ ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

| ì˜µì…˜ | ì„¤ëª… | ì¥ì  | ë‹¨ì  |
|------|------|------|------|
| **Public Cloud** | Langfuse ê´€ë¦¬í˜• ì„œë¹„ìŠ¤ | ì¦‰ì‹œ ì‹œì‘, ìœ ì§€ë³´ìˆ˜ ë¶ˆí•„ìš” | ë°ì´í„°ê°€ ì™¸ë¶€ ì„œë²„ì— ì €ì¥ |
| **Self-hosted Fargate** | AWS ECSì— ì§ì ‘ ë°°í¬ | ë°ì´í„° ì™„ì „ ì œì–´, VPC ë‚´ë¶€ ìš´ì˜ | ì¸í”„ë¼ ê´€ë¦¬ í•„ìš” |

### Option 1: Public Langfuse Cloud

ê°€ì¥ ë¹ ë¥´ê²Œ ì‹œì‘í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì…ë‹ˆë‹¤. **Free tier**ê°€ ì œê³µë©ë‹ˆë‹¤.

**ì„¤ì • ë°©ë²•:**
1. [langfuse.com](https://langfuse.com) ì—ì„œ ê³„ì • ìƒì„±
2. í”„ë¡œì íŠ¸ ìƒì„±
3. Settings â†’ API Keysì—ì„œ í‚¤ ë°œê¸‰
4. `.env` íŒŒì¼ ì„¤ì •:
   ```bash
   LANGFUSE_PUBLIC_KEY=pk-lf-your-public-key
   LANGFUSE_SECRET_KEY=sk-lf-your-secret-key
   LANGFUSE_BASE_URL=https://us.cloud.langfuse.com  # US ë¦¬ì „
   # ë˜ëŠ” https://cloud.langfuse.com  # EU ë¦¬ì „
   ```

**ë¦¬ì „ë³„ ì—”ë“œí¬ì¸íŠ¸:**
| ë¦¬ì „ | Base URL |
|------|----------|
| US (ë¯¸êµ­) | `https://us.cloud.langfuse.com` |
| EU (ìœ ëŸ½) | `https://cloud.langfuse.com` |

### Option 2: Self-hosted on AWS Fargate

ë°ì´í„°ë¥¼ AWS ë‚´ë¶€ì—ì„œ ì™„ì „íˆ ì œì–´í•˜ë ¤ë©´ ECS Fargateì— Langfuseë¥¼ ì§ì ‘ ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ë°°í¬ ê°€ì´ë“œ:** [deploy-langfuse-on-ecs-with-fargate](https://github.com/gonsoomoon-ml/deploy-langfuse-on-ecs-with-fargate)

**ì•„í‚¤í…ì²˜:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AWS VPC                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚     ALB     â”‚â”€â”€â”€â–¶â”‚  ECS Fargate â”‚â”€â”€â”€â–¶â”‚   Aurora    â”‚     â”‚
â”‚  â”‚  (Public)   â”‚    â”‚  (Langfuse)  â”‚    â”‚ PostgreSQL  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â”‚                                                    â”‚
â”‚         â”‚ HTTP/HTTPS                                         â”‚
â”‚         â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              AgentCore Runtime                       â”‚    â”‚
â”‚  â”‚         (OTEL traces â†’ Langfuse ALB)                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì„¤ì • ë°©ë²•:**
1. GitHub ì €ì¥ì†Œ í´ë¡  ë° CDK ë°°í¬
2. ë°°í¬ ì™„ë£Œ í›„ ALB DNS í™•ì¸
3. Langfuse ì›¹ UI (ALB ì£¼ì†Œ)ì—ì„œ í”„ë¡œì íŠ¸ ë° API í‚¤ ìƒì„±
4. `.env` íŒŒì¼ ì„¤ì •:
   ```bash
   LANGFUSE_PUBLIC_KEY=pk-lf-your-key
   LANGFUSE_SECRET_KEY=sk-lf-your-key
   LANGFUSE_BASE_URL=http://your-alb-endpoint.region.elb.amazonaws.com
   ```

**Self-hosted ì¥ì :**
- ë°ì´í„°ê°€ AWS VPC ë‚´ë¶€ì—ë§Œ ì €ì¥
- ê¸°ì—… ë³´ì•ˆ ì •ì±… ì¤€ìˆ˜ ìš©ì´
- ë„¤íŠ¸ì›Œí¬ ì§€ì—° ì‹œê°„ ìµœì†Œí™”
- ì»¤ìŠ¤í…€ ë„ë©”ì¸ ë° SSL ì„¤ì • ê°€ëŠ¥

---

## ì•„í‚¤í…ì²˜: ë™ì‘ ì›ë¦¬

ì—ì´ì „íŠ¸ ì½”ë“œì—ì„œ Langfuseê¹Œì§€ì˜ ë°ì´í„° íë¦„ì„ ë³´ì—¬ì¤ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ì—ì´ì „íŠ¸ ì½”ë“œ                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ LLM í˜¸ì¶œ    â”‚â”€â”€â”€â–¶â”‚ ë„êµ¬ í˜¸ì¶œ   â”‚â”€â”€â”€â–¶â”‚ LLM í˜¸ì¶œ    â”‚              â”‚
â”‚  â”‚ (Claude)    â”‚    â”‚ (ë°˜í’ˆ í™•ì¸) â”‚    â”‚ (ìµœì¢… ì‘ë‹µ) â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                  â”‚                  â”‚                      â”‚
â”‚         â–¼                  â–¼                  â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Strands Telemetry (ìë™ ê³„ì¸¡)                   â”‚    â”‚
â”‚  â”‚   - ìˆ˜ì§‘ í•­ëª©: ì…ë ¥, ì¶œë ¥, í† í°, ì§€ì—°ì‹œê°„, ì˜¤ë¥˜              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ OTEL í”„ë¡œí† ì½œ (HTTP/gRPC)
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   OTEL Exporter     â”‚
                    â”‚ (OTLP over HTTPS)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ Authorization: Basic {base64(pk:sk)}
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     Langfuse        â”‚
                    â”‚  /api/public/otel   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## OpenTelemetry: ì—°ê²° ë‹¤ë¦¬

OpenTelemetry (OTEL)ëŠ” ë¶„ì‚° íŠ¸ë ˆì´ì‹±ì„ ìœ„í•œ **CNCF í‘œì¤€**ì…ë‹ˆë‹¤. ì—ì´ì „íŠ¸ì™€ Langfuse ì‚¬ì´ì˜ ë‹¤ë¦¬ ì—­í• ì„ í•©ë‹ˆë‹¤.

### í•µì‹¬ ê°œë…

| ê°œë… | ì„¤ëª… | Langfuse ë§¤í•‘ |
|------|------|---------------|
| **Trace (íŠ¸ë ˆì´ìŠ¤)** | í•˜ë‚˜ì˜ ì™„ì „í•œ ìš”ì²­/ì‘ë‹µ ì‚¬ì´í´ | Langfuse Trace |
| **Span (ìŠ¤íŒ¬)** | íŠ¸ë ˆì´ìŠ¤ ë‚´ì˜ ê°œë³„ ì‘ì—… ë‹¨ìœ„ | Langfuse Observation |
| **Event (ì´ë²¤íŠ¸)** | ìŠ¤íŒ¬ ë‚´ì—ì„œ íŠ¹ì • ì‹œì ì— ë°œìƒí•œ ì¼ | Langfuse Event |
| **Attribute (ì†ì„±)** | ìŠ¤íŒ¬ì— ì²¨ë¶€ëœ í‚¤-ê°’ ë©”íƒ€ë°ì´í„° | Langfuse Metadata |

### Strands Telemetry ë™ì‘ ë°©ì‹

`StrandsTelemetry().setup_otlp_exporter()`ë¥¼ í˜¸ì¶œí•˜ë©´ ë‹¤ìŒì´ ìˆ˜í–‰ë©ë‹ˆë‹¤:

1. ì„¤ì •ëœ exporterë¡œ OTEL SDK ì´ˆê¸°í™”
2. Strands Agent SDK ìë™ ê³„ì¸¡ (instrumentation)
3. ëª¨ë“  LLM í˜¸ì¶œ, ë„êµ¬ ì‹¤í–‰, ì—ì´ì „íŠ¸ ìƒëª…ì£¼ê¸° ì´ë²¤íŠ¸ ìº¡ì²˜
4. ì„¤ì •ëœ ì—”ë“œí¬ì¸íŠ¸ë¡œ íŠ¸ë ˆì´ìŠ¤ ë°°ì¹˜ ì „ì†¡

```python
from strands.telemetry import StrandsTelemetry

# ì´ í•œ ì¤„ë¡œ ëª¨ë“  í…”ë ˆë©”íŠ¸ë¦¬ê°€ í™œì„±í™”ë©ë‹ˆë‹¤
strands_telemetry = StrandsTelemetry().setup_otlp_exporter()
```

---

## íŠ¸ë ˆì´ìŠ¤ ê³„ì¸µ êµ¬ì¡°ì™€ ìˆ˜ì§‘ ë°ì´í„°

### íŠ¸ë ˆì´ìŠ¤ êµ¬ì¡°

```
Trace (ì—ì´ì „íŠ¸ í˜¸ì¶œë‹¹ í•˜ë‚˜)
â”‚
â”œâ”€â”€ Span: agent.invoke
â”‚   â”œâ”€â”€ Attribute: user.id = "customer@example.com"
â”‚   â”œâ”€â”€ Attribute: session.id = "session-123"
â”‚   â”‚
â”‚   â”œâ”€â”€ Span: llm.chat (ì²« ë²ˆì§¸ LLM í˜¸ì¶œ)
â”‚   â”‚   â”œâ”€â”€ Event: gen_ai.system.message (ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸)
â”‚   â”‚   â”œâ”€â”€ Event: gen_ai.user.message (ì‚¬ìš©ì ì…ë ¥)
â”‚   â”‚   â”œâ”€â”€ Event: gen_ai.choice (tool_use ê²°ì •)
â”‚   â”‚   â”œâ”€â”€ Attribute: gen_ai.usage.input_tokens = 1500
â”‚   â”‚   â”œâ”€â”€ Attribute: gen_ai.usage.output_tokens = 200
â”‚   â”‚   â””â”€â”€ Attribute: gen_ai.response.model = "claude-3-7-sonnet"
â”‚   â”‚
â”‚   â”œâ”€â”€ Span: tool.execute (ë„êµ¬ í˜¸ì¶œ)
â”‚   â”‚   â”œâ”€â”€ Attribute: tool.name = "check_return_eligibility"
â”‚   â”‚   â”œâ”€â”€ Attribute: tool.input = {"order_id": "ORD-123"}
â”‚   â”‚   â”œâ”€â”€ Attribute: tool.output = {"eligible": true, ...}
â”‚   â”‚   â””â”€â”€ Attribute: duration_ms = 150
â”‚   â”‚
â”‚   â””â”€â”€ Span: llm.chat (ë‘ ë²ˆì§¸ LLM í˜¸ì¶œ - ìµœì¢… ì‘ë‹µ)
â”‚       â”œâ”€â”€ Event: gen_ai.tool.message (ë„êµ¬ ê²°ê³¼)
â”‚       â”œâ”€â”€ Event: gen_ai.choice (end_turn)
â”‚       â””â”€â”€ Attribute: gen_ai.usage.output_tokens = 350
```

### ê° ë ˆë²¨ì—ì„œ ìˆ˜ì§‘ë˜ëŠ” ë°ì´í„°

| ë ˆë²¨ | ë°ì´í„° | ëª©ì  |
|------|--------|------|
| **Trace** | trace_id, session_id, user_id, tags | ê´€ë ¨ ì‘ì—… ê·¸ë£¹í™” |
| **Span** | name, start_time, end_time, status | ê°œë³„ ì‘ì—… ì¸¡ì • |
| **Event** | gen_ai.* ì´ë²¤íŠ¸ì™€ ë‚´ìš© | ë©”ì‹œì§€ ë‚´ìš© ìº¡ì²˜ |
| **Attribute** | tokens, model, latency, metadata | ë©”íŠ¸ë¦­ ë° ì»¨í…ìŠ¤íŠ¸ |

### ì´ë²¤íŠ¸ ìœ í˜• (gen_ai.* ë„¤ì„ìŠ¤í˜ì´ìŠ¤)

| ì´ë²¤íŠ¸ | ì„¤ëª… |
|--------|------|
| `gen_ai.system.message` | ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ë‚´ìš© |
| `gen_ai.user.message` | ì‚¬ìš©ì ì…ë ¥ ë©”ì‹œì§€ |
| `gen_ai.assistant.message` | LLM ì‘ë‹µ (ë„êµ¬ í˜¸ì¶œ í¬í•¨) |
| `gen_ai.tool.message` | ë„êµ¬ ì‹¤í–‰ ê²°ê³¼ |
| `gen_ai.choice` | LLM ê²°ì • (`tool_use` ë˜ëŠ” `end_turn`) |
| `strands.telemetry.tracer` | Strands ì—ì´ì „íŠ¸ ë‚´ë¶€ ì´ë²¤íŠ¸ |

---

## ì¸ì¦ íë¦„

LangfuseëŠ” OTEL HTTP ì—”ë“œí¬ì¸íŠ¸ì—ì„œ **Basic Auth**ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

### ë‹¨ê³„ë³„ ì„¤ì •

```python
# Step 1: Langfuse í”„ë¡œì íŠ¸ ì„¤ì •ì—ì„œ ìê²© ì¦ëª… ê°€ì ¸ì˜¤ê¸°
LANGFUSE_PUBLIC_KEY = "pk-lf-xxxxxxxx"
LANGFUSE_SECRET_KEY = "sk-lf-xxxxxxxx"

# Step 2: Basic Auth í† í° ìƒì„±
import base64
auth_string = f"{LANGFUSE_PUBLIC_KEY}:{LANGFUSE_SECRET_KEY}"
auth_token = base64.b64encode(auth_string.encode()).decode()
# ê²°ê³¼: "cGstbGYteHh4eHh4eHg6c2stbGYteHh4eHh4eHg="

# Step 3: OTEL exporter í—¤ë” ì„¤ì •
os.environ["OTEL_EXPORTER_OTLP_ENDPOINT"] = "https://us.cloud.langfuse.com/api/public/otel"
os.environ["OTEL_EXPORTER_OTLP_HEADERS"] = f"Authorization=Basic {auth_token}"
```

### HTTP ìš”ì²­ í˜•ì‹

íŠ¸ë ˆì´ìŠ¤ê°€ Langfuseë¡œ ì „ì†¡ë  ë•Œ:

```
POST https://us.cloud.langfuse.com/api/public/otel/v1/traces
Headers:
  Authorization: Basic cGstbGYteHh4eHh4eHg6c2stbGYteHh4eHh4eHg=
  Content-Type: application/x-protobuf
Body: [protobuf í˜•ì‹ì˜ OTEL íŠ¸ë ˆì´ìŠ¤ ë°ì´í„°]
```

### Langfuse ì—”ë“œí¬ì¸íŠ¸

| ë¦¬ì „ | ì—”ë“œí¬ì¸íŠ¸ |
|------|-----------|
| US (ë¯¸êµ­) | `https://us.cloud.langfuse.com/api/public/otel` |
| EU (ìœ ëŸ½) | `https://cloud.langfuse.com/api/public/otel` |
| Self-hosted | `https://your-domain.com/api/public/otel` |

---

## ë°°í¬ ëª¨ë“œ

### ëª¨ë“œ A: ë¡œì»¬ ê°œë°œ (Direct OTEL)

ê°œë°œ ë° í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ì—ì´ì „íŠ¸ë¥¼ ë¡œì»¬ì—ì„œ ì‹¤í–‰í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

```python
import os
import base64
from strands import Agent
from strands.telemetry import StrandsTelemetry
from strands.models.bedrock import BedrockModel

# Langfuse ìê²© ì¦ëª… ì„¤ì •
os.environ["LANGFUSE_PUBLIC_KEY"] = "pk-lf-..."
os.environ["LANGFUSE_SECRET_KEY"] = "sk-lf-..."
os.environ["LANGFUSE_BASE_URL"] = "https://us.cloud.langfuse.com"

LANGFUSE_AUTH = base64.b64encode(
    f"{os.environ['LANGFUSE_PUBLIC_KEY']}:{os.environ['LANGFUSE_SECRET_KEY']}".encode()
).decode()

os.environ["OTEL_EXPORTER_OTLP_ENDPOINT"] = f"{os.environ['LANGFUSE_BASE_URL']}/api/public/otel"
os.environ["OTEL_EXPORTER_OTLP_HEADERS"] = f"Authorization=Basic {LANGFUSE_AUTH}"

# í…”ë ˆë©”íŠ¸ë¦¬ ì´ˆê¸°í™” - Langfuseë¡œ ì§ì ‘ ì „ì†¡
StrandsTelemetry().setup_otlp_exporter()

model = BedrockModel(model_id="us.anthropic.claude-3-7-sonnet-20250219-v1:0")

agent = Agent(
    model=model,
    system_prompt="ë‹¹ì‹ ì€ ì¹œì ˆí•œ ë„ìš°ë¯¸ì…ë‹ˆë‹¤.",
    trace_attributes={
        "session.id": "local-test-123",
        "user.id": "developer@example.com",
        "langfuse.tags": ["development", "test"]
    }
)

# íŠ¸ë ˆì´ìŠ¤ê°€ ì¦‰ì‹œ Langfuseë¡œ ì „ì†¡ë©ë‹ˆë‹¤
response = agent("ì•ˆë…•í•˜ì„¸ìš”, ì–´ë–¤ ë„ì›€ì´ í•„ìš”í•˜ì„¸ìš”?")
```

**ë°ì´í„° íë¦„:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ë¡œì»¬ ì½”ë“œ    â”‚â”€â”€OTELâ”€â”€â–¶â”‚   Langfuse   â”‚
â”‚              â”‚         â”‚   Cloud      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ëª¨ë“œ B: AgentCore Runtime (ì»¨í…Œì´ë„ˆ í™˜ê²½)

í”„ë¡œë•ì…˜ì—ì„œ ì—ì´ì „íŠ¸ë¥¼ AgentCore Runtimeì— ë°°í¬í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

**ì—”íŠ¸ë¦¬í¬ì¸íŠ¸ íŒŒì¼ (ì˜ˆ: `agent_entrypoint.py`):**

```python
from bedrock_agentcore.runtime import BedrockAgentCoreApp
from strands import Agent
from strands.telemetry import StrandsTelemetry
from strands.models.bedrock import BedrockModel

app = BedrockAgentCoreApp()

def initialize_agent():
    """í™˜ê²½ ë³€ìˆ˜ì—ì„œ í…”ë ˆë©”íŠ¸ë¦¬ ì„¤ì •ìœ¼ë¡œ ì—ì´ì „íŠ¸ ì´ˆê¸°í™”."""
    # launch() ì‹œ ì„¤ì •ëœ OTEL_* í™˜ê²½ ë³€ìˆ˜ë¥¼ í…”ë ˆë©”íŠ¸ë¦¬ê°€ ì½ìŠµë‹ˆë‹¤
    StrandsTelemetry().setup_otlp_exporter()

    model = BedrockModel(model_id="us.anthropic.claude-3-7-sonnet-20250219-v1:0")

    agent = Agent(
        model=model,
        system_prompt="ë‹¹ì‹ ì€ ì¹œì ˆí•œ ë„ìš°ë¯¸ì…ë‹ˆë‹¤.",
        tools=[...]
    )
    return agent

@app.entrypoint
async def invoke(payload):
    """AgentCore Runtimeìš© ìŠ¤íŠ¸ë¦¬ë° ì—”íŠ¸ë¦¬í¬ì¸íŠ¸."""
    agent = initialize_agent()
    user_input = payload.get("prompt", "")

    async for event in agent.stream_async(user_input):
        yield event

if __name__ == "__main__":
    app.run()
```

**ë°°í¬ ë…¸íŠ¸ë¶:**

```python
import base64
from bedrock_agentcore_starter_toolkit import Runtime

# Langfuse ì„¤ì •
langfuse_public_key = "pk-lf-..."
langfuse_secret_key = "sk-lf-..."
langfuse_auth = base64.b64encode(
    f"{langfuse_public_key}:{langfuse_secret_key}".encode()
).decode()

otel_endpoint = "https://us.cloud.langfuse.com/api/public/otel"
otel_headers = f"Authorization=Basic {langfuse_auth}"

# ëŸ°íƒ€ì„ ì„¤ì •
runtime = Runtime()
runtime.configure(
    entrypoint="agent_entrypoint.py",
    execution_role=execution_role_arn,
    agent_name="my-agent-with-langfuse",
    region=region,
    disable_otel=True,  # CloudWatch OTEL ë¹„í™œì„±í™”, Langfuse ëŒ€ì‹  ì‚¬ìš©
)

# Langfuse í™˜ê²½ ë³€ìˆ˜ì™€ í•¨ê»˜ ë°°í¬
runtime.launch(
    env_vars={
        "OTEL_EXPORTER_OTLP_ENDPOINT": otel_endpoint,
        "OTEL_EXPORTER_OTLP_HEADERS": otel_headers,
        "DISABLE_ADOT_OBSERVABILITY": "true"
    }
)
```

**ë°ì´í„° íë¦„:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   AgentCore Runtime                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ì»¨í…Œì´ë„ˆ    â”‚    â”‚   Strands    â”‚    â”‚    OTEL      â”‚  â”‚
â”‚  â”‚  (ECR)       â”‚â”€â”€â”€â–¶â”‚   Agent      â”‚â”€â”€â”€â–¶â”‚   Exporter   â”‚â”€â”€â”¼â”€â”€â–¶ Langfuse
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â–²                                                    â”‚
â”‚         â”‚ launch()ì˜ env_vars                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## í™˜ê²½ ì„¤ì •

### í™˜ê²½ ë³€ìˆ˜

| ë³€ìˆ˜ | ìš©ë„ | ì˜ˆì‹œ |
|------|------|------|
| `LANGFUSE_PUBLIC_KEY` | Langfuse ê³µê°œ API í‚¤ | `pk-lf-xxxxxxxx` |
| `LANGFUSE_SECRET_KEY` | Langfuse ë¹„ë°€ API í‚¤ | `sk-lf-xxxxxxxx` |
| `LANGFUSE_BASE_URL` | Langfuse ì¸ìŠ¤í„´ìŠ¤ URL | `https://us.cloud.langfuse.com` |
| `OTEL_EXPORTER_OTLP_ENDPOINT` | OTEL exporter ì—”ë“œí¬ì¸íŠ¸ | `https://us.cloud.langfuse.com/api/public/otel` |
| `OTEL_EXPORTER_OTLP_HEADERS` | OTEL ì¸ì¦ í—¤ë” | `Authorization=Basic xxx...` |
| `OTEL_SERVICE_NAME` | íŠ¸ë ˆì´ìŠ¤ì˜ ì„œë¹„ìŠ¤ ì´ë¦„ | `ecommerce-agent` |
| `DISABLE_ADOT_OBSERVABILITY` | AWS ADOT ë¹„í™œì„±í™” | `true` |

### íŠ¸ë ˆì´ìŠ¤ ì†ì„±

Agent ìƒì„±ìì—ì„œ íŠ¸ë ˆì´ìŠ¤ ì†ì„±ì„ ì„¤ì •í•˜ì—¬ Langfuseì—ì„œ ë°ì´í„°ë¥¼ ì •ë¦¬í•©ë‹ˆë‹¤:

```python
agent = Agent(
    model=model,
    trace_attributes={
        # Langfuse ê·¸ë£¹í™”ì— í•„ìˆ˜
        "session.id": "unique-session-id",      # ë©€í‹°í„´ ëŒ€í™” ê·¸ë£¹í™”
        "user.id": "customer@example.com",      # ì‚¬ìš©ìë³„ ë¶„ì„

        # Langfuse ì „ìš© (ì„ íƒì‚¬í•­)
        "langfuse.tags": ["production", "kr"],  # í•„í„° ê°€ëŠ¥í•œ íƒœê·¸
        "langfuse.metadata": {                  # ì»¤ìŠ¤í…€ ë©”íƒ€ë°ì´í„°
            "customer_tier": "premium",
            "order_value": 150000
        }
    }
)
```

### ì„¤ì¹˜

```bash
# í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install strands-agents[otel] langfuse

# ë˜ëŠ” UV ì‚¬ìš©
uv add strands-agents[otel] langfuse
```

> **ì¤‘ìš”:** OpenTelemetry ê³„ì¸¡ì„ í™œì„±í™”í•˜ë ¤ë©´ `[otel]` extraê°€ í•„ìš”í•©ë‹ˆë‹¤.

---

## ì—ì´ì „íŠ¸ ë£¨í”„ ìƒì„¸ ë¶„ì„

ì—ì´ì „íŠ¸ê°€ ìš”ì²­ì„ ì²˜ë¦¬í•  ë•Œ íŠ¸ë ˆì´ìŠ¤ë˜ëŠ” ë‚´ìš©ì…ë‹ˆë‹¤:

```
ìš”ì²­: "ë°˜í’ˆí•˜ê³  ì‹¶ì–´ìš”"

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Trace: agent-invocation-abc123                                       â”‚
â”‚ Session: lab5-session-xyz                                           â”‚
â”‚ User: customer@example.com                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚ [0ms] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚       â”‚                                                              â”‚
â”‚       â–¼                                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Span: llm.chat.completion (1200ms)                              â”‚ â”‚
â”‚ â”‚ Model: us.anthropic.claude-3-7-sonnet                           â”‚ â”‚
â”‚ â”‚ Input Tokens: 1,847  |  Output Tokens: 156                      â”‚ â”‚
â”‚ â”‚                                                                  â”‚ â”‚
â”‚ â”‚ Events:                                                          â”‚ â”‚
â”‚ â”‚   â€¢ gen_ai.system.message: "ë‹¹ì‹ ì€ K-Style ì´ì»¤ë¨¸ìŠ¤..."          â”‚ â”‚
â”‚ â”‚   â€¢ gen_ai.user.message: "ë°˜í’ˆí•˜ê³  ì‹¶ì–´ìš”"                       â”‚ â”‚
â”‚ â”‚   â€¢ gen_ai.choice: tool_use â†’ check_return_eligibility          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚       â”‚                                                              â”‚
â”‚       â–¼                                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Span: tool.check_return_eligibility (89ms)                      â”‚ â”‚
â”‚ â”‚ Input: {"order_id": "ORD-20240115-TEST"}                        â”‚ â”‚
â”‚ â”‚ Output: {"eligible": true, "reason": "14ì¼ ì´ë‚´", ...}          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚       â”‚                                                              â”‚
â”‚       â–¼                                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Span: llm.chat.completion (1850ms)                              â”‚ â”‚
â”‚ â”‚ Model: us.anthropic.claude-3-7-sonnet                           â”‚ â”‚
â”‚ â”‚ Input Tokens: 2,103  |  Output Tokens: 287                      â”‚ â”‚
â”‚ â”‚                                                                  â”‚ â”‚
â”‚ â”‚ Events:                                                          â”‚ â”‚
â”‚ â”‚   â€¢ gen_ai.tool.message: {"eligible": true, ...}                â”‚ â”‚
â”‚ â”‚   â€¢ gen_ai.choice: end_turn                                     â”‚ â”‚
â”‚ â”‚   â€¢ gen_ai.assistant.message: "ë„¤, ë°˜í’ˆ ê°€ëŠ¥í•©ë‹ˆë‹¤..."           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â”‚ [3139ms] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                                      â”‚
â”‚ ì´ê³„: 3.14ì´ˆ | í† í°: 3,950 ì…ë ¥ / 443 ì¶œë ¥ | ë¹„ìš©: $0.0156          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Langfuseì—ì„œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ì •ë³´

Langfuseê°€ OTEL íŠ¸ë ˆì´ìŠ¤ë¥¼ ìˆ˜ì‹ í•˜ë©´ ë‹¤ìŒì„ ì œê³µí•©ë‹ˆë‹¤:

| ê¸°ëŠ¥ | íŠ¸ë ˆì´ìŠ¤ ë°ì´í„° í™œìš© ë°©ì‹ |
|------|--------------------------|
| **íŠ¸ë ˆì´ìŠ¤ íƒ€ì„ë¼ì¸** | ìŠ¤íŒ¬ì„ íƒ€ì´ë°ê³¼ í•¨ê»˜ ê³„ì¸µì ìœ¼ë¡œ ì‹œê°í™” |
| **ë¹„ìš© ê³„ì‚°** | `input_tokens` + `output_tokens` + ëª¨ë¸ ê°€ê²© ì‚¬ìš© |
| **ì§€ì—° ì‹œê°„ ë¶„ì„** | ì‘ì—… ìœ í˜•ë³„ ìŠ¤íŒ¬ ì§€ì† ì‹œê°„ ì§‘ê³„ |
| **ì„¸ì…˜ ê·¸ë£¹í™”** | `session.id` ì†ì„±ìœ¼ë¡œ íŠ¸ë ˆì´ìŠ¤ ê·¸ë£¹í™” |
| **ì‚¬ìš©ì ë¶„ì„** | `user.id`ë³„ ì‚¬ìš©ëŸ‰ ì¶”ì  |
| **ì˜¤ë¥˜ ë””ë²„ê¹…** | ìŠ¤íŒ¬ ìƒíƒœ ë° ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ |
| **LLM Playground** | ìº¡ì²˜ëœ ë©”ì‹œì§€ë¡œ í”„ë¡¬í”„íŠ¸ ì¬ì‹¤í–‰ |
| **í‰ê°€** | ìº¡ì²˜ëœ ì…ì¶œë ¥ì— LLM-as-a-judge ì‹¤í–‰ |

---

## ë‹¨ê³„ë³„ LLM ì…ì¶œë ¥

ì´ ì„¹ì…˜ì€ ì—ì´ì „íŠ¸ ë£¨í”„ì˜ ê° ë‹¨ê³„ì—ì„œ LLMì— ì…ì¶œë ¥ë˜ëŠ” ì‹¤ì œ ë©”ì‹œì§€ ë‚´ìš©ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.

### Step 1: ì²« ë²ˆì§¸ LLM í˜¸ì¶œ (ì‚¬ìš©ì ìš”ì²­ â†’ ë„êµ¬ ê²°ì •)

**LLM ì…ë ¥:**

```json
{
  "messages": [
    {
      "role": "system",
      "content": "ë‹¹ì‹ ì€ K-Style ì´ì»¤ë¨¸ìŠ¤ ê³ ê° ì§€ì› ì—ì´ì „íŠ¸ì…ë‹ˆë‹¤.\n\nì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬:\n- check_return_eligibility: ì£¼ë¬¸ì˜ ë°˜í’ˆ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸\n- get_product_recommendations: ìƒí’ˆ ì¶”ì²œ\n- process_return_request: ë°˜í’ˆ ì²˜ë¦¬\n\nê³ ê°ì—ê²Œ ì¹œì ˆí•˜ê³  ë„ì›€ì´ ë˜ëŠ” ì‘ë‹µì„ ì œê³µí•˜ì„¸ìš”."
    },
    {
      "role": "user",
      "content": "ì£¼ë¬¸ë²ˆí˜¸ ORD-20240115-TESTì˜ 'í”Œë¼ì›Œ íŒ¨í„´ ì›í”¼ìŠ¤' ë°˜í’ˆì´ ê°€ëŠ¥í•œê°€ìš”?"
    }
  ],
  "tools": [
    {
      "name": "check_return_eligibility",
      "description": "ì£¼ë¬¸ì˜ ë°˜í’ˆ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸",
      "input_schema": {
        "type": "object",
        "properties": {
          "order_id": {"type": "string"}
        },
        "required": ["order_id"]
      }
    }
  ]
}
```

**LLM ì¶œë ¥:**

```json
{
  "role": "assistant",
  "content": [
    {
      "type": "text",
      "text": "ë„¤, ì£¼ë¬¸ë²ˆí˜¸ ORD-20240115-TESTì˜ ë°˜í’ˆ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ í™•ì¸í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤."
    },
    {
      "type": "tool_use",
      "id": "toolu_01ABC123",
      "name": "check_return_eligibility",
      "input": {
        "order_id": "ORD-20240115-TEST"
      }
    }
  ],
  "stop_reason": "tool_use",
  "usage": {
    "input_tokens": 1500,
    "output_tokens": 156
  }
}
```

### Step 2: ë„êµ¬ ì‹¤í–‰ (ì—ì´ì „íŠ¸ ëŸ°íƒ€ì„, LLM ì•„ë‹˜)

ì—ì´ì „íŠ¸ ëŸ°íƒ€ì„ì´ ë„êµ¬ í•¨ìˆ˜ë¥¼ ë¡œì»¬ì—ì„œ ì‹¤í–‰í•©ë‹ˆë‹¤. ì´ê²ƒì€ LLM í˜¸ì¶œì´ **ì•„ë‹™ë‹ˆë‹¤**.

**ë„êµ¬ ì…ë ¥:**

```json
{
  "order_id": "ORD-20240115-TEST"
}
```

**ë„êµ¬ ì¶œë ¥:**

```json
{
  "order_id": "ORD-20240115-TEST",
  "product_name": "í”Œë¼ì›Œ íŒ¨í„´ ì›í”¼ìŠ¤",
  "eligible": true,
  "reason": "êµ¬ë§¤ í›„ 14ì¼ ì´ë‚´",
  "purchase_date": "2024-01-15",
  "return_deadline": "2024-01-29",
  "refund_amount": 89000,
  "return_method": "ë¬´ë£Œ ë°˜í’ˆ í”½ì—…"
}
```

### Step 3: ë‘ ë²ˆì§¸ LLM í˜¸ì¶œ (ë„êµ¬ ê²°ê³¼ â†’ ìµœì¢… ì‘ë‹µ)

**LLM ì…ë ¥:**

ì´ì „ ë©”ì‹œì§€ê°€ ëª¨ë‘ í¬í•¨ë©ë‹ˆë‹¤ (ëŒ€í™” íˆìŠ¤í† ë¦¬ ëˆ„ì ).

```json
{
  "messages": [
    {
      "role": "system",
      "content": "ë‹¹ì‹ ì€ K-Style ì´ì»¤ë¨¸ìŠ¤ ê³ ê° ì§€ì› ì—ì´ì „íŠ¸ì…ë‹ˆë‹¤..."
    },
    {
      "role": "user",
      "content": "ì£¼ë¬¸ë²ˆí˜¸ ORD-20240115-TESTì˜ 'í”Œë¼ì›Œ íŒ¨í„´ ì›í”¼ìŠ¤' ë°˜í’ˆì´ ê°€ëŠ¥í•œê°€ìš”?"
    },
    {
      "role": "assistant",
      "content": [
        {
          "type": "text",
          "text": "ë„¤, ì£¼ë¬¸ë²ˆí˜¸ ORD-20240115-TESTì˜ ë°˜í’ˆ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ í™•ì¸í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤."
        },
        {
          "type": "tool_use",
          "id": "toolu_01ABC123",
          "name": "check_return_eligibility",
          "input": {"order_id": "ORD-20240115-TEST"}
        }
      ]
    },
    {
      "role": "user",
      "content": [
        {
          "type": "tool_result",
          "tool_use_id": "toolu_01ABC123",
          "content": "{\"order_id\": \"ORD-20240115-TEST\", \"product_name\": \"í”Œë¼ì›Œ íŒ¨í„´ ì›í”¼ìŠ¤\", \"eligible\": true, \"reason\": \"êµ¬ë§¤ í›„ 14ì¼ ì´ë‚´\", \"purchase_date\": \"2024-01-15\", \"return_deadline\": \"2024-01-29\", \"refund_amount\": 89000, \"return_method\": \"ë¬´ë£Œ ë°˜í’ˆ í”½ì—…\"}"
        }
      ]
    }
  ]
}
```

**LLM ì¶œë ¥:**

```json
{
  "role": "assistant",
  "content": [
    {
      "type": "text",
      "text": "ë„¤, ì£¼ë¬¸ë²ˆí˜¸ ORD-20240115-TESTì˜ 'í”Œë¼ì›Œ íŒ¨í„´ ì›í”¼ìŠ¤' ë°˜í’ˆì´ ê°€ëŠ¥í•©ë‹ˆë‹¤!\n\nğŸ“‹ **ë°˜í’ˆ ì •ë³´**\n- **ë°˜í’ˆ ê°€ëŠ¥ ì—¬ë¶€**: ê°€ëŠ¥\n- **ì‚¬ìœ **: êµ¬ë§¤ í›„ 14ì¼ ì´ë‚´ (êµ¬ë§¤ì¼: 2024-01-15)\n- **ë°˜í’ˆ ê¸°í•œ**: 2024ë…„ 1ì›” 29ì¼ê¹Œì§€\n- **í™˜ë¶ˆ ê¸ˆì•¡**: 89,000ì›\n- **ë°˜í’ˆ ë°©ë²•**: ë¬´ë£Œ ë°˜í’ˆ í”½ì—…\n\në°˜í’ˆì„ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì§„í–‰ì„ ì›í•˜ì‹œë©´ ë§ì”€í•´ ì£¼ì„¸ìš”. ë¬´ë£Œ í”½ì—… ì„œë¹„ìŠ¤ë¥¼ ì˜ˆì•½í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤."
    }
  ],
  "stop_reason": "end_turn",
  "usage": {
    "input_tokens": 2103,
    "output_tokens": 287
  }
}
```

### ì‹œê°ì  íë¦„ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ì—ì´ì „íŠ¸ ë£¨í”„                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  STEP 1: ì²« ë²ˆì§¸ LLM í˜¸ì¶œ                                                 â•‘  â”‚
â”‚  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£  â”‚
â”‚  â•‘                                                                           â•‘  â”‚
â”‚  â•‘  ì…ë ¥                                ì¶œë ¥                                  â•‘  â”‚
â”‚  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â•‘  â”‚
â”‚  â•‘  â”‚ System: K-Style     â”‚           â”‚ Text: "í™•ì¸í•´       â”‚               â•‘  â”‚
â”‚  â•‘  â”‚ ê³ ê° ì§€ì› ì—ì´ì „íŠ¸... â”‚    â”€â”€â”€â–¶   â”‚ ë“œë¦¬ê² ìŠµë‹ˆë‹¤"       â”‚               â•‘  â”‚
â”‚  â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â•‘  â”‚
â”‚  â•‘  â”‚ User: "ë°˜í’ˆì´       â”‚           â”‚ Tool Use:           â”‚               â•‘  â”‚
â”‚  â•‘  â”‚ ê°€ëŠ¥í•œê°€ìš”?"        â”‚           â”‚ check_return_       â”‚               â•‘  â”‚
â”‚  â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚ eligibility         â”‚               â•‘  â”‚
â”‚  â•‘  â”‚ Tools: [check_      â”‚           â”‚ {order_id: "ORD-"}  â”‚               â•‘  â”‚
â”‚  â•‘  â”‚ return_eligibility] â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â•‘  â”‚
â”‚  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           stop_reason: "tool_use"               â•‘  â”‚
â”‚  â•‘                                                                           â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                     â”‚                                            â”‚
â”‚                                     â–¼                                            â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  STEP 2: ë„êµ¬ ì‹¤í–‰ (ì—ì´ì „íŠ¸ ëŸ°íƒ€ì„ - LLM ì•„ë‹˜)                           â•‘  â”‚
â”‚  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£  â”‚
â”‚  â•‘                                                                           â•‘  â”‚
â”‚  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â•‘  â”‚
â”‚  â•‘  â”‚ ë„êµ¬ ì…ë ¥:          â”‚           â”‚ ë„êµ¬ ì¶œë ¥:          â”‚               â•‘  â”‚
â”‚  â•‘  â”‚ {                   â”‚    â”€â”€â”€â–¶   â”‚ {                   â”‚               â•‘  â”‚
â”‚  â•‘  â”‚   order_id:         â”‚  (DB/API) â”‚   eligible: true,   â”‚               â•‘  â”‚
â”‚  â•‘  â”‚   "ORD-20240115"    â”‚           â”‚   refund: 89000,    â”‚               â•‘  â”‚
â”‚  â•‘  â”‚ }                   â”‚           â”‚   deadline: "1/29"  â”‚               â•‘  â”‚
â”‚  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ }                   â”‚               â•‘  â”‚
â”‚  â•‘                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â•‘  â”‚
â”‚  â•‘                                                                           â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                     â”‚                                            â”‚
â”‚                                     â–¼                                            â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  STEP 3: ë‘ ë²ˆì§¸ LLM í˜¸ì¶œ                                                 â•‘  â”‚
â”‚  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£  â”‚
â”‚  â•‘                                                                           â•‘  â”‚
â”‚  â•‘  ì…ë ¥                                ì¶œë ¥                                  â•‘  â”‚
â”‚  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â•‘  â”‚
â”‚  â•‘  â”‚ System: (ë™ì¼)      â”‚           â”‚ Text:               â”‚               â•‘  â”‚
â”‚  â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚ "ë„¤, ë°˜í’ˆì´         â”‚               â•‘  â”‚
â”‚  â•‘  â”‚ User: "ë°˜í’ˆ ê°€ëŠ¥?"  â”‚    â”€â”€â”€â–¶   â”‚ ê°€ëŠ¥í•©ë‹ˆë‹¤!         â”‚               â•‘  â”‚
â”‚  â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚                     â”‚               â•‘  â”‚
â”‚  â•‘  â”‚ Assistant: tool_use â”‚           â”‚ ğŸ“‹ ë°˜í’ˆ ì •ë³´        â”‚               â•‘  â”‚
â”‚  â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚ - í™˜ë¶ˆ: 89,000ì›    â”‚               â•‘  â”‚
â”‚  â•‘  â”‚ User (tool_result): â”‚           â”‚ - ê¸°í•œ: 1/29        â”‚               â•‘  â”‚
â”‚  â•‘  â”‚ {eligible: true...} â”‚           â”‚ - ë¬´ë£Œ í”½ì—… ê°€ëŠ¥"   â”‚               â•‘  â”‚
â”‚  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â•‘  â”‚
â”‚  â•‘                                    stop_reason: "end_turn"               â•‘  â”‚
â”‚  â•‘                                                                           â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë©”ì‹œì§€ ëˆ„ì  íŒ¨í„´

í•µì‹¬ ì¸ì‚¬ì´íŠ¸: **ë©”ì‹œì§€ëŠ” ê° LLM í˜¸ì¶œë§ˆë‹¤ ëˆ„ì ë©ë‹ˆë‹¤**:

| LLM í˜¸ì¶œ | ì»¨í…ìŠ¤íŠ¸ ë‚´ ë©”ì‹œì§€ |
|----------|-------------------|
| **1ë²ˆì§¸** | `[system, user]` |
| **2ë²ˆì§¸** | `[system, user, assistant(tool_use), user(tool_result)]` |
| **3ë²ˆì§¸** (í•„ìš”ì‹œ) | `[system, user, assistant, user(tool_result), assistant(tool_use_2), user(tool_result_2)]` |

ì´ê²ƒì´ `input_tokens`ê°€ ê° í˜¸ì¶œë§ˆë‹¤ ì¦ê°€í•˜ëŠ” ì´ìœ ì…ë‹ˆë‹¤:
- 1ë²ˆì§¸ í˜¸ì¶œ: 1,500 í† í° (system + user)
- 2ë²ˆì§¸ í˜¸ì¶œ: 2,103 í† í° (system + user + assistant + tool_result)

### ë©€í‹° ë„êµ¬ ì˜ˆì‹œ

ì—ì´ì „íŠ¸ê°€ ì—¬ëŸ¬ ë„êµ¬ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²½ìš°, ë£¨í”„ê°€ ê³„ì†ë©ë‹ˆë‹¤:

```
Step 1: LLM â†’ tool_use (ë„êµ¬ A)
Step 2: ë„êµ¬ A ì‹¤í–‰ â†’ ê²°ê³¼ A
Step 3: LLM â†’ tool_use (ë„êµ¬ B)  â† ê²°ê³¼ Aë¥¼ ë°›ê³  ë‹¤ë¥¸ ë„êµ¬ í˜¸ì¶œ ê²°ì •
Step 4: ë„êµ¬ B ì‹¤í–‰ â†’ ê²°ê³¼ B
Step 5: LLM â†’ end_turn           â† ë‘ ê²°ê³¼ë¥¼ ë°›ê³  ìµœì¢… ì‘ë‹µ ìƒì„±
```

**ë©€í‹° ë„êµ¬ì˜ ë©”ì‹œì§€ ëˆ„ì :**

```json
{
  "messages": [
    {"role": "system", "content": "..."},
    {"role": "user", "content": "ì›ë˜ ì§ˆë¬¸"},
    {"role": "assistant", "content": [{"type": "tool_use", "name": "tool_A", ...}]},
    {"role": "user", "content": [{"type": "tool_result", "tool_use_id": "A", ...}]},
    {"role": "assistant", "content": [{"type": "tool_use", "name": "tool_B", ...}]},
    {"role": "user", "content": [{"type": "tool_result", "tool_use_id": "B", ...}]}
  ]
}
```

---

## CloudWatch vs Langfuse ë¹„êµ

### ê¸°ëŠ¥ ë¹„êµ

| ê¸°ëŠ¥ | CloudWatch GenAI Observability | Langfuse |
|------|-------------------------------|----------|
| **ì„¤ì •** | ìë™ (AgentCore ê¸°ë³¸ê°’) | ìˆ˜ë™ ì„¤ì • í•„ìš” |
| **ë¹„ìš© ì¶”ì ** | ê¸°ë³¸ | ëª¨ë¸ë³„ ìƒì„¸ ê°€ê²© |
| **LLM Playground** | ì—†ìŒ | ìˆìŒ (í”„ë¡¬í”„íŠ¸ ì§ì ‘ í…ŒìŠ¤íŠ¸) |
| **í‰ê°€** | ìˆ˜ë™ | LLM-as-a-judge ë‚´ì¥ |
| **í”„ë¡¬í”„íŠ¸ ê´€ë¦¬** | ì—†ìŒ | ë²„ì „ ê´€ë¦¬ ì§€ì› |
| **ì˜¤í”ˆ ì†ŒìŠ¤** | ì•„ë‹ˆì˜¤ | ì˜ˆ (ì…€í”„ í˜¸ìŠ¤íŒ… ê°€ëŠ¥) |
| **AWS ë„¤ì´í‹°ë¸Œ** | ì˜ˆ | íŒŒíŠ¸ë„ˆ í†µí•© |
| **X-Ray í†µí•©** | ì˜ˆ | ì—†ìŒ |
| **Logs Insights** | ì˜ˆ | ì œí•œì  |

### ë°ì´í„° íë¦„ ë¹„êµ

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚            AgentCore Runtime                     â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
                    â”‚  â”‚          Strands Agent                   â”‚    â”‚
                    â”‚  â”‚    (OTEL ê³„ì¸¡ í¬í•¨)                       â”‚    â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                    â”‚                     â”‚                            â”‚
                    â”‚                     â”‚ OTEL íŠ¸ë ˆì´ìŠ¤              â”‚
                    â”‚                     â–¼                            â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
                    â”‚  â”‚         OTEL Collector/Exporter          â”‚    â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                    â”‚              â”‚                  â”‚                â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚                  â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ (ê¸°ë³¸ê°’: AWS ADOT)                       â”‚ (ì»¤ìŠ¤í…€: Langfuse)    â”‚
           â–¼                                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CloudWatch GenAI      â”‚                â”‚       Langfuse          â”‚
â”‚   Observability         â”‚                â”‚                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ AWS ë„¤ì´í‹°ë¸Œ          â”‚                â”‚ â€¢ ì˜¤í”ˆ ì†ŒìŠ¤             â”‚
â”‚ â€¢ ìë™ í™œì„±í™”           â”‚                â”‚ â€¢ LLM Playground        â”‚
â”‚ â€¢ X-Ray í†µí•©            â”‚                â”‚ â€¢ í”„ë¡¬í”„íŠ¸ ë²„ì „ ê´€ë¦¬    â”‚
â”‚ â€¢ ê¸°ë³¸ ëŒ€ì‹œë³´ë“œ         â”‚                â”‚ â€¢ LLM-as-judge í‰ê°€     â”‚
â”‚ â€¢ Logs Insights ì¿¼ë¦¬    â”‚                â”‚ â€¢ í’ë¶€í•œ UI             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤ë³„ ê¶Œì¥ì‚¬í•­

| ì‚¬ìš© ì‚¬ë¡€ | ê¶Œì¥ |
|----------|------|
| AWS ì „ìš© ì¸í”„ë¼, ìµœì†Œ ì„¤ì • ì›í•˜ëŠ” ê²½ìš° | CloudWatch |
| í”„ë¡¬í”„íŠ¸ ë²„ì „ ê´€ë¦¬ ë° A/B í…ŒìŠ¤íŠ¸ í•„ìš” | Langfuse |
| LLM-as-a-judge í‰ê°€ ì›í•˜ëŠ” ê²½ìš° | Langfuse |
| X-Ray ë¶„ì‚° íŠ¸ë ˆì´ì‹± í•„ìš” | CloudWatch |
| ì˜¤í”ˆ ì†ŒìŠ¤ / ì…€í”„ í˜¸ìŠ¤íŒ… ìš”êµ¬ì‚¬í•­ | Langfuse |
| ë©€í‹°í´ë¼ìš°ë“œ ë˜ëŠ” í•˜ì´ë¸Œë¦¬ë“œ ë°°í¬ | Langfuse |

---

## êµ¬í˜„ ì˜ˆì œ

### ì˜ˆì œ 1: Langfuseë¡œ ë¡œì»¬ ê°œë°œ

```python
import os
import base64
from strands import Agent
from strands.telemetry import StrandsTelemetry
from strands.models.bedrock import BedrockModel

# Langfuse ì„¤ì •
os.environ["LANGFUSE_PUBLIC_KEY"] = "pk-lf-..."
os.environ["LANGFUSE_SECRET_KEY"] = "sk-lf-..."
LANGFUSE_AUTH = base64.b64encode(
    f"{os.environ['LANGFUSE_PUBLIC_KEY']}:{os.environ['LANGFUSE_SECRET_KEY']}".encode()
).decode()
os.environ["OTEL_EXPORTER_OTLP_ENDPOINT"] = "https://us.cloud.langfuse.com/api/public/otel"
os.environ["OTEL_EXPORTER_OTLP_HEADERS"] = f"Authorization=Basic {LANGFUSE_AUTH}"

# í…”ë ˆë©”íŠ¸ë¦¬ ì´ˆê¸°í™”
StrandsTelemetry().setup_otlp_exporter()

# ì—ì´ì „íŠ¸ ìƒì„±
model = BedrockModel(model_id="us.anthropic.claude-3-7-sonnet-20250219-v1:0")
agent = Agent(
    model=model,
    system_prompt="ë‹¹ì‹ ì€ ì¹œì ˆí•œ ì´ì»¤ë¨¸ìŠ¤ ë„ìš°ë¯¸ì…ë‹ˆë‹¤.",
    trace_attributes={
        "session.id": "dev-session-001",
        "user.id": "developer@example.com"
    }
)

# ì—ì´ì „íŠ¸ ì‹¤í–‰
response = agent("ì–´ë–¤ ìƒí’ˆì´ ìˆë‚˜ìš”?")
print(response)
```

### ì˜ˆì œ 2: Langfuseì™€ AgentCore Runtime

**íŒŒì¼: `langfuse_agent.py`**

```python
import os
from bedrock_agentcore.runtime import BedrockAgentCoreApp
from strands import Agent, tool
from strands.telemetry import StrandsTelemetry
from strands.models.bedrock import BedrockModel

app = BedrockAgentCoreApp()

@tool
def check_return_eligibility(order_id: str) -> dict:
    """ì£¼ë¬¸ì˜ ë°˜í’ˆ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤."""
    return {
        "order_id": order_id,
        "eligible": True,
        "reason": "14ì¼ ë°˜í’ˆ ê¸°ê°„ ë‚´"
    }

def create_agent():
    StrandsTelemetry().setup_otlp_exporter()

    model = BedrockModel(
        model_id=os.getenv("BEDROCK_MODEL_ID", "us.anthropic.claude-3-7-sonnet-20250219-v1:0")
    )

    return Agent(
        model=model,
        system_prompt="ë‹¹ì‹ ì€ K-Style ì´ì»¤ë¨¸ìŠ¤ ê³ ê° ì§€ì› ì—ì´ì „íŠ¸ì…ë‹ˆë‹¤.",
        tools=[check_return_eligibility]
    )

@app.entrypoint
async def invoke(payload):
    agent = create_agent()
    user_input = payload.get("prompt", "")
    async for event in agent.stream_async(user_input):
        yield event

if __name__ == "__main__":
    app.run()
```

**ë°°í¬:**

```python
import base64
from bedrock_agentcore_starter_toolkit import Runtime

# Langfuse ìê²© ì¦ëª…
langfuse_pk = "pk-lf-..."
langfuse_sk = "sk-lf-..."
langfuse_auth = base64.b64encode(f"{langfuse_pk}:{langfuse_sk}".encode()).decode()

runtime = Runtime()
runtime.configure(
    entrypoint="langfuse_agent.py",
    execution_role=execution_role_arn,
    agent_name="ecommerce-agent-langfuse",
    region=region,
    disable_otel=True,
)

runtime.launch(
    env_vars={
        "BEDROCK_MODEL_ID": "us.anthropic.claude-3-7-sonnet-20250219-v1:0",
        "OTEL_EXPORTER_OTLP_ENDPOINT": "https://us.cloud.langfuse.com/api/public/otel",
        "OTEL_EXPORTER_OTLP_HEADERS": f"Authorization=Basic {langfuse_auth}",
        "DISABLE_ADOT_OBSERVABILITY": "true"
    }
)
```

### ì˜ˆì œ 3: Strandsì™€ Langfuse Python SDK í•¨ê»˜ ì‚¬ìš©

ê³ ê¸‰ ì‚¬ìš© ì‚¬ë¡€ì˜ ê²½ìš°, Strands í…”ë ˆë©”íŠ¸ë¦¬ì™€ Langfuseì˜ Python SDKë¥¼ ê²°í•©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```python
from langfuse import observe, propagate_attributes, get_client
from strands import Agent
from strands.telemetry import StrandsTelemetry

StrandsTelemetry().setup_otlp_exporter()

@observe()
def process_customer_request(user_input: str, customer_id: str):
    """ì¶”ê°€ Langfuse ì¶”ì ê³¼ í•¨ê»˜ ê³ ê° ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤."""
    with propagate_attributes(
        user_id=customer_id,
        session_id=f"session-{customer_id}",
        tags=["customer-support"],
        metadata={"source": "web-chat"}
    ):
        agent = Agent(model=model, tools=[...])
        result = agent(user_input)

        # ì»¤ìŠ¤í…€ ë°ì´í„°ë¡œ íŠ¸ë ˆì´ìŠ¤ ì—…ë°ì´íŠ¸
        langfuse = get_client()
        langfuse.update_current_trace(
            input=user_input,
            output=result,
            metadata={"customer_id": customer_id}
        )

        return result

langfuse.flush()  # ëª¨ë“  íŠ¸ë ˆì´ìŠ¤ê°€ ì „ì†¡ë˜ë„ë¡ ë³´ì¥
```

---

## ë¬¸ì œ í•´ê²°

### ì˜¤ë¥˜: Langfuseì— íŠ¸ë ˆì´ìŠ¤ê°€ ë‚˜íƒ€ë‚˜ì§€ ì•ŠìŒ

**ê°€ëŠ¥í•œ ì›ì¸:**

1. **OTEL extra ëˆ„ë½**: `[otel]`ê³¼ í•¨ê»˜ ì„¤ì¹˜í–ˆëŠ”ì§€ í™•ì¸
   ```bash
   pip install strands-agents[otel]
   ```

2. **ì˜ëª»ëœ ìê²© ì¦ëª…**: public/secret í‚¤ í™•ì¸
   ```python
   # ì¸ì¦ í…ŒìŠ¤íŠ¸
   import requests
   response = requests.get(
       "https://us.cloud.langfuse.com/api/public/health",
       headers={"Authorization": f"Basic {langfuse_auth}"}
   )
   print(response.status_code)  # 200ì´ì–´ì•¼ í•¨
   ```

3. **í…”ë ˆë©”íŠ¸ë¦¬ ë¯¸ì´ˆê¸°í™”**: ì—ì´ì „íŠ¸ ìƒì„± ì „ì— `setup_otlp_exporter()` í˜¸ì¶œ í™•ì¸

4. **í™˜ê²½ ë³€ìˆ˜ ë¯¸ì„¤ì •**: í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜ í™•ì¸
   ```python
   print(os.environ.get("OTEL_EXPORTER_OTLP_ENDPOINT"))
   print(os.environ.get("OTEL_EXPORTER_OTLP_HEADERS"))
   ```

### ì˜¤ë¥˜: ADOTê³¼ Langfuse ì¶©ëŒ

**ì›ì¸**: CloudWatch ADOTê³¼ Langfuse OTEL exporterê°€ ëª¨ë‘ í™œì„±í™”ë¨

**í•´ê²°ì±…**: Langfuse ì‚¬ìš© ì‹œ ADOT ë¹„í™œì„±í™”
```python
runtime.configure(
    ...
    disable_otel=True,  # AgentCore ë‚´ì¥ OTEL ë¹„í™œì„±í™”
)

runtime.launch(
    env_vars={
        "DISABLE_ADOT_OBSERVABILITY": "true",
        ...
    }
)
```

### ì˜¤ë¥˜: Langfuseì—ì„œ íŠ¸ë ˆì´ìŠ¤ ì†ì„± ëˆ„ë½

**ì›ì¸**: Agentì— `trace_attributes` ë¯¸ì „ë‹¬

**í•´ê²°ì±…**: í•­ìƒ íŠ¸ë ˆì´ìŠ¤ ì†ì„± í¬í•¨
```python
agent = Agent(
    model=model,
    trace_attributes={
        "session.id": session_id,
        "user.id": user_id
    }
)
```

### ì˜¤ë¥˜: íŠ¸ë ˆì´ìŠ¤ ì „ë‹¬ ì§€ì—° ì‹œê°„ ë†’ìŒ

**ì›ì¸**: íŠ¸ë ˆì´ìŠ¤ê°€ ë°°ì¹˜ë¡œ ì£¼ê¸°ì ìœ¼ë¡œ ì „ì†¡ë¨

**í•´ê²°ì±…**: ì‹¤ì‹œê°„ ë””ë²„ê¹… ì‹œ ìˆ˜ë™ìœ¼ë¡œ flush
```python
from langfuse import get_client
langfuse = get_client()
langfuse.flush()
```

---

## ì°¸ê³  ìë£Œ

### ê³µì‹ ë¬¸ì„œ

- [Langfuse + Amazon Bedrock í†µí•©](https://langfuse.com/integrations/model-providers/amazon-bedrock)
- [Langfuse + Amazon Bedrock AgentCore](https://langfuse.com/integrations/frameworks/amazon-agentcore)
- [Langfuse + Strands Agents](https://langfuse.com/integrations/frameworks/strands-agents)
- [AWS ë¸”ë¡œê·¸: Langfuseì™€ AgentCore ê´€ì¸¡ì„±](https://aws.amazon.com/blogs/machine-learning/amazon-bedrock-agentcore-observability-with-langfuse/)

### ìƒ˜í”Œ ì½”ë“œ

- [AgentCore ìƒ˜í”Œ - Langfuse ë…¸íŠ¸ë¶](https://github.com/awslabs/amazon-bedrock-agentcore-samples/blob/main/01-tutorials/06-AgentCore-observability/04-Agentcore-runtime-partner-observability/Langfuse/runtime_with_strands_and_langfuse.ipynb)
- [Strands Agents ê´€ì¸¡ì„± ìƒ˜í”Œ](https://github.com/strands-agents/samples/blob/main/01-tutorials/01-fundamentals/08-observability-and-evaluation/Observability-and-Evaluation-sample.ipynb)
- [Langfuse ë¬¸ì„œ - AWS Strands Agents ì¿¡ë¶](https://github.com/langfuse/langfuse-docs/blob/main/cookbook/integration_aws_strands_agents.ipynb)

### Self-hosted ë°°í¬

- [AWS Fargateì— Langfuse ë°°í¬](https://github.com/gonsoomoon-ml/deploy-langfuse-on-ecs-with-fargate) - AWS Fargateì— Langfuse ë°°í¬ ê°€ì´ë“œ

### ê´€ë ¨ ë¬¸ì„œ

- [Amazon Bedrock AgentCore ë¬¸ì„œ](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/)
- [OpenTelemetry Python SDK](https://opentelemetry.io/docs/languages/python/)
- [Langfuse OpenTelemetry í†µí•©](https://langfuse.com/docs/integrations/opentelemetry)
