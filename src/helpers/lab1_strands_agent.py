from strands.tools import tool

ECOMMERCE_MODEL_ID = "us.anthropic.claude-3-5-sonnet-20241022-v2:0"

# System prompt defining the agent's role and capabilities
ECOMMERCE_SYSTEM_PROMPT = """ë‹¹ì‹ ì€ í•œêµ­ ì´ì»¤ë¨¸ìŠ¤ ì‡¼í•‘ëª° K-Styleì˜ ê³ ê° ì§€ì› ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

ë‹¹ì‹ ì˜ ì—­í• ì€:
- ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬ë¥¼ í™œìš©í•˜ì—¬ ì •í™•í•œ ì •ë³´ ì œê³µ
- ì£¼ë¬¸, ë°°ì†¡, ë°˜í’ˆ, êµí™˜ ê´€ë ¨ ê³ ê° ì§€ì›
- ê³ ê°ì—ê²Œ ì¹œì ˆí•˜ê³  ì¸ë‚´ì‹¬ ìˆê²Œ ëŒ€ì‘
- ì§ˆë¬¸ì— ë‹µë³€í•œ í›„ í•­ìƒ ì¶”ê°€ ë„ì›€ ì œì•ˆ
- ë„ìš¸ ìˆ˜ ì—†ëŠ” ê²½ìš° ì ì ˆí•œ ì—°ë½ì²˜ë¡œ ì•ˆë‚´

ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬:
1. check_return_eligibility() - ë°˜í’ˆ ìê²© í™•ì¸
2. process_return_request() - ë°˜í’ˆ ìš”ì²­ ì²˜ë¦¬  
3. get_product_recommendations() - ìƒí’ˆ ì¶”ì²œ

í•­ìƒ ì •ì¤‘í•˜ê³  ì¹œê·¼í•œ í†¤ìœ¼ë¡œ ì‘ë‹µí•˜ë©°, ê³ ê°ì˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë° ìµœì„ ì„ ë‹¤í•´ì£¼ì„¸ìš”."""


@tool
def check_return_eligibility(order_number: str, item_name: str) -> str:
    """
    ì£¼ë¬¸ ìƒí’ˆì˜ ë°˜í’ˆ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

    Args:
        order_number: ì£¼ë¬¸ë²ˆí˜¸ (ì˜ˆ: 'ORD-20240101-001')
        item_name: ìƒí’ˆëª… (ì˜ˆ: 'í”Œë¼ì›Œ íŒ¨í„´ ì›í”¼ìŠ¤')

    Returns:
        ë°˜í’ˆ ìê²© ì—¬ë¶€ì™€ ì¡°ê±´ì— ëŒ€í•œ ì •ë³´
    """
    # ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì£¼ë¬¸ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¡°íšŒ
    return_policies = {
        "íŒ¨ì…˜": {
            "window": "14ì¼",
            "condition": "íƒë°°ë¥¼ ë°›ì€ ë‚ ë¡œë¶€í„° 14ì¼ ì´ë‚´, ìƒí’ˆ íƒœê·¸ ë³´ì¡´, ì°©ìš©í•˜ì§€ ì•Šì€ ìƒíƒœ",
            "process": "ê³ ê°ì„¼í„° ë˜ëŠ” ì˜¨ë¼ì¸ ë°˜í’ˆ ì‹ ì²­",
            "refund_time": "ìƒí’ˆ íšŒìˆ˜ í›„ 3-5 ì˜ì—…ì¼",
            "shipping": "ë¬´ë£Œ ë°˜í’ˆ (ë‹¨ìˆœ ë³€ì‹¬ ì‹œ ê³ ê° ë¶€ë‹´)"
        },
        "ë·°í‹°": {
            "window": "7ì¼", 
            "condition": "ë¯¸ê°œë´‰ ìƒí’ˆë§Œ ê°€ëŠ¥, ê°œì¸ìœ„ìƒìƒ ê°œë´‰ í›„ ë°˜í’ˆ ë¶ˆê°€",
            "process": "ê³ ê°ì„¼í„° ë¬¸ì˜ í•„ìˆ˜",
            "refund_time": "ìƒí’ˆ íšŒìˆ˜ í›„ 3-5 ì˜ì—…ì¼",
            "shipping": "ë¬´ë£Œ ë°˜í’ˆ (ë¶ˆëŸ‰í’ˆì¸ ê²½ìš°ë§Œ)"
        }
    }

    # ìƒí’ˆ ì¹´í…Œê³ ë¦¬ ì¶”ì •
    category = "íŒ¨ì…˜"
    if any(keyword in item_name for keyword in ["ë¦½ìŠ¤í‹±", "íŒŒìš´ë°ì´ì…˜", "ì¿ ì…˜", "í¬ë¦¼", "ë¡œì…˜"]):
        category = "ë·°í‹°"

    policy = return_policies.get(category, return_policies["íŒ¨ì…˜"])
    
    return f"ë°˜í’ˆ ì •ì±… - {item_name}:\n\n" \
           f"â€¢ ë°˜í’ˆ ê¸°ê°„: ë°°ì†¡ ì™„ë£Œì¼ë¡œë¶€í„° {policy['window']}\n" \
           f"â€¢ ë°˜í’ˆ ì¡°ê±´: {policy['condition']}\n" \
           f"â€¢ ì‹ ì²­ ë°©ë²•: {policy['process']}\n" \
           f"â€¢ í™˜ë¶ˆ ì²˜ë¦¬: {policy['refund_time']}\n" \
           f"â€¢ ë°°ì†¡ë¹„: {policy['shipping']}\n\n" \
           f"ì£¼ë¬¸ë²ˆí˜¸ {order_number}ì˜ {item_name} ìƒí’ˆì€ ë°˜í’ˆ ê°€ëŠ¥í•©ë‹ˆë‹¤."


@tool
def process_return_request(order_number: str, reason: str) -> str:
    """
    ë°˜í’ˆ ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

    Args:
        order_number: ì£¼ë¬¸ë²ˆí˜¸
        reason: ë°˜í’ˆ ì‚¬ìœ  (ì˜ˆ: 'ì‚¬ì´ì¦ˆ ë¶ˆë§Œì¡±', 'ìƒ‰ìƒ ì°¨ì´', 'ë¶ˆëŸ‰í’ˆ')

    Returns:
        ë°˜í’ˆ ì²˜ë¦¬ ìƒíƒœ ë° ë‹¤ìŒ ë‹¨ê³„ ì•ˆë‚´
    """
    # ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ë°˜í’ˆ ì‹œìŠ¤í…œì— ìš”ì²­ì„ ë“±ë¡
    tracking_number = f"RET-{order_number[-6:]}"
    
    return f"ë°˜í’ˆ ìš”ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n" \
           f"â€¢ ë°˜í’ˆ ë²ˆí˜¸: {tracking_number}\n" \
           f"â€¢ ì£¼ë¬¸ë²ˆí˜¸: {order_number}\n" \
           f"â€¢ ë°˜í’ˆ ì‚¬ìœ : {reason}\n" \
           f"â€¢ ì²˜ë¦¬ ìƒíƒœ: ì ‘ìˆ˜ ì™„ë£Œ\n\n" \
           f"ë‹¤ìŒ ë‹¨ê³„:\n" \
           f"1. íƒë°° íšŒì‚¬ì—ì„œ 2-3ì¼ ë‚´ ìƒí’ˆ ìˆ˜ê±° ì—°ë½\n" \
           f"2. ìƒí’ˆ í¬ì¥ í›„ ìˆ˜ê±° ëŒ€ê¸°\n" \
           f"3. ìƒí’ˆ í™•ì¸ í›„ í™˜ë¶ˆ ì²˜ë¦¬ (3-5 ì˜ì—…ì¼)\n\n" \
           f"ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ë°˜í’ˆë²ˆí˜¸ì™€ í•¨ê»˜ ê³ ê°ì„¼í„°ë¡œ ì—°ë½ì£¼ì„¸ìš”."


@tool
def get_product_recommendations(category: str, budget: str = "ìƒê´€ì—†ìŒ") -> str:
    """
    ì¹´í…Œê³ ë¦¬ì™€ ì˜ˆì‚°ì— ë”°ë¥¸ ìƒí’ˆì„ ì¶”ì²œí•©ë‹ˆë‹¤.

    Args:
        category: ìƒí’ˆ ì¹´í…Œê³ ë¦¬ (ì˜ˆ: 'íŒ¨ì…˜', 'ë·°í‹°', 'ì›í”¼ìŠ¤', 'ë¦½ìŠ¤í‹±')
        budget: ì˜ˆì‚° ë²”ìœ„ (ì˜ˆ: '5ë§Œì› ì´í•˜', '10ë§Œì›ëŒ€')

    Returns:
        ì¶”ì²œ ìƒí’ˆ ëª©ë¡ê³¼ ìƒì„¸ ì •ë³´
    """
    # ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ìƒí’ˆ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒ
    recommendations = {
        "íŒ¨ì…˜": [
            {"name": "í”Œë¼ì›Œ íŒ¨í„´ ì›í”¼ìŠ¤", "price": "89,000ì›", "rating": "4.8/5", "feature": "ë´„ ì‹ ìƒ, ë¬´ë£Œë°°ì†¡"},
            {"name": "í¬ë¡­ ë‹ˆíŠ¸ ê°€ë””ê±´", "price": "65,000ì›", "rating": "4.7/5", "feature": "ë°ì¼ë¦¬ ì•„ì´í…œ"},
            {"name": "ì™€ì´ë“œ ë°ë‹˜ íŒ¬ì¸ ", "price": "79,000ì›", "rating": "4.9/5", "feature": "í¸ì•ˆí•œ í•"}
        ],
        "ë·°í‹°": [
            {"name": "ì¿ ì…˜ íŒŒìš´ë°ì´ì…˜", "price": "45,000ì›", "rating": "4.6/5", "feature": "ìì—°ìŠ¤ëŸ¬ìš´ ì»¤ë²„ë ¥"},
            {"name": "ë§¤íŠ¸ ë¦½ìŠ¤í‹±", "price": "28,000ì›", "rating": "4.8/5", "feature": "ì˜¤ë˜ê°€ëŠ” ì§€ì†ë ¥"},
            {"name": "ê¸€ë¡œìš° í•˜ì´ë¼ì´í„°", "price": "32,000ì›", "rating": "4.7/5", "feature": "ì´‰ì´‰í•œ ìœ¤ê¸°"}
        ],
        "ì›í”¼ìŠ¤": [
            {"name": "í”Œë¼ì›Œ íŒ¨í„´ ì›í”¼ìŠ¤", "price": "89,000ì›", "rating": "4.8/5", "feature": "ë´„ ì‹ ìƒ, ë¬´ë£Œë°°ì†¡"},
            {"name": "ì²´í¬ ë¯¸ë‹ˆ ì›í”¼ìŠ¤", "price": "72,000ì›", "rating": "4.6/5", "feature": "ííŠ¸í•œ ë””ìì¸"},
            {"name": "ë¸”ë™ ë¡± ì›í”¼ìŠ¤", "price": "95,000ì›", "rating": "4.9/5", "feature": "í¬ë©€ ë£©"}
        ]
    }

    # ì¹´í…Œê³ ë¦¬ë³„ ì¶”ì²œ ìƒí’ˆ ì°¾ê¸°
    products = recommendations.get(category, recommendations.get("íŒ¨ì…˜", []))
    
    result = f"ğŸ›ï¸ {category} ì¹´í…Œê³ ë¦¬ ì¶”ì²œ ìƒí’ˆ:\n\n"
    for i, product in enumerate(products, 1):
        result += f"{i}. {product['name']}\n"
        result += f"   ğŸ’° ê°€ê²©: {product['price']}\n"
        result += f"   â­ í‰ì : {product['rating']}\n"
        result += f"   âœ¨ íŠ¹ì§•: {product['feature']}\n\n"
    
    result += "ğŸ’ ì§€ê¸ˆ ì£¼ë¬¸í•˜ì‹œë©´ ë¬´ë£Œë°°ì†¡ì´ë©°, 14ì¼ ì´ë‚´ ë¬´ë£Œ ë°˜í’ˆì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.\n"
    result += "ë” ìì„¸í•œ ìƒí’ˆ ì •ë³´ë‚˜ ë‹¤ë¥¸ ì¹´í…Œê³ ë¦¬ ì¶”ì²œì´ í•„ìš”í•˜ì‹œë©´ ë§ì”€í•´ ì£¼ì„¸ìš”!"
    
    return result